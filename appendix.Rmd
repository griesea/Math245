---
title: "Final Project Appendix"
author: "Alex G. and Max M."
date: "5/31/2017"
output: pdf_document
---

```{r}
library(car)
library(lattice)
econ <- read.csv("https://raw.githubusercontent.com/griesea/Math245/master/finaldata.csv", header = TRUE, sep = ",")
#Creating ratio of imports to exports
econ$TradeRatio <- econ$Imports/econ$Exports
econ
```

##Performing EDA:

```{r}
scatterplotMatrix(~ GDP_Rate + Inflation + IntRate + PrimEducRate +SecEducRate + TerEducRate, data = econ)
scatterplotMatrix(~ GDP_Rate + MCapRate+ Population + TradeRatio + Unemployment + S.P500 + Poverty, data = econ)
```

We see that some of our variables (specifically MCapRate and Population) appear to be highly colinear (we will deal with this later).

###Transformations

Inflation looks like it needs a transformation. However, economic theory suggests an interaction between inflation rate and interest rate. We will investigate this below.
```{r,fig.height=4}
plot(GDP_Rate ~ (Inflation) , data = econ)
```

We dont appear to need a tranformation to IntRate (no convincing trend appears).

```{r,fig.height=4}
plot(GDP_Rate ~ (IntRate) , data = econ)
```

From the matrix above, it appears that MCapRate might both be curved. We examine this trend further, below. There looks to be a parabolic relationship between GDP_Rate and MCapRate. We will thus include a quadratic term in our model.

```{r,fig.height=4}
plot(GDP_Rate ~ MCapRate , data = econ)
```

Next, we check if there is a transformation needed for the population explanatory variable. There does not seem any clear indication that there needs to be a transformation based on the below plot.

```{r,fig.height=4}
plot(GDP_Rate ~ Population , data = econ)
```

Next, we check if there is a transformation needed for the primary education explanatory variable. There is some clustering we would like to get rid of. However, no transformation seems to make the relationship between GDP_Rate and PrimEducRate any better.

```{r,fig.height=4}
par(mfrow=c(1,2))
plot(GDP_Rate ~ PrimEducRate , data = econ)
plot(GDP_Rate ~ sqrt(PrimEducRate) , data = econ)

plot(GDP_Rate ~ PrimEducRate , data = econ)
plot(GDP_Rate ~ log(I(PrimEducRate/100)) , data = econ)

plot(GDP_Rate ~ PrimEducRate , data = econ)
plot(GDP_Rate ~ I(1/(PrimEducRate)) , data = econ)
par(mfrow=c(1,1))
```

Next, we check if there is a transformation needed for the secondary education explanatory variable. There is some clustering we would like to get rid of. However, no transformations seem to improve the fit.

```{r,fig.height=4}
par(mfrow=c(1,2))
plot(GDP_Rate ~ SecEducRate , data = econ)
plot(GDP_Rate ~ log(SecEducRate) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ SecEducRate , data = econ)
plot(GDP_Rate ~ I(1/(SecEducRate)) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ SecEducRate , data = econ)
plot(GDP_Rate ~ sqrt(SecEducRate) , data = econ)
par(mfrow=c(1,1))
```

Finally, we check if there is a transformation needed for the tertiary education explanatory variable. There is some clustering we would like to get rid of. However, no transformations seem to improve the fit.

```{r,fig.height=4}
par(mfrow=c(1,2))
plot(GDP_Rate ~ TerEducRate , data = econ)
plot(GDP_Rate ~ log(TerEducRate) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ TerEducRate , data = econ)
plot(GDP_Rate ~ I(1/(TerEducRate)) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ TerEducRate , data = econ)
plot(GDP_Rate ~ sqrt(TerEducRate) , data = econ)
par(mfrow=c(1,1))
```


Trade ratio, poverty rate, and unemployment show no convincing needs for transformations:
```{r, fig.height = 4}
par(mfrow=c(1,3))
plot(GDP_Rate ~ (TradeRatio), data=econ)
plot(GDP_Rate ~ Unemployment, data=econ)
plot(GDP_Rate ~ Poverty, data=econ)
par(mfrow=c(1,1))
```

S.P500 looks like it might have a quadratic effect. We will add this term in our model.
```{r}
plot(GDP_Rate ~ (S.P500) , data = econ)
```

###Checking for interaction terms

Economic theory suggests that there should be an interaction term between interest rate and inflation. Testing this: 

```{r}
xyplot(GDP_Rate ~ Inflation | equal.count(IntRate), data=econ)
```

We do see a slight shift in the effect of inflation on GDP rate at differing interest rates. It seems that inflation is better for GDP rate at lower interest rates (i.e. the effect of inflation is more positive). We will thus include this interaction term.

###Preliminary Linear Model

Fitting the linear model we decided upon above: 
```{r}
test.lm1 <- lm(GDP_Rate ~ Inflation*IntRate + PrimEducRate +SecEducRate + TerEducRate + I(MCapRate^2)+ MCapRate + Population + TradeRatio + Unemployment + I(S.P500^2) + S.P500 + Poverty +President + Senate + House, data = econ)
summary(test.lm1)
```


###Checking Residual Plots
















Resudual plots for Population, Trade Ratio and unemployment appear to have no obvious trends and be evenly distributed around 0. This justifies our decision to not transform these variables.
```{r}
par(mfrow = c(1,3))
plot(resid(test.lm1) ~ econ$Population)
abline(h=0)
plot(resid(test.lm1) ~ econ$TradeRatio)
abline(h=0)
plot(resid(test.lm1) ~ econ$Unemployment)
abline(h=0)
par(mfrow = c(1,1))
```

```{r}
plot(resid(test.lm1) ~ econ$Unemployment)
abline(h=0)
```

