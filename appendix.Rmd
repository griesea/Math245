---
title: "Final Project Appendix"
author: "Alex G. and Max M."
date: "5/31/2017"
output: pdf_document
---

```{r}
library(car)
library(lattice)
econ <- read.csv("https://raw.githubusercontent.com/griesea/Math245/master/finaldata.csv", header = TRUE, sep = ",")
#Creating ratio of imports to exports
econ$TradeRatio <- econ$Imports/econ$Exports
econ
```

##Performing EDA:

```{r}
scatterplotMatrix(~ GDP_Rate + Inflation + IntRate + PrimEducRate +SecEducRate + TerEducRate, data = econ)
scatterplotMatrix(~ GDP_Rate + MCapRate+ Population + TradeRatio + Unemployment + S.P500 + Poverty, data = econ)
```

We see that some of our variables (specifically MCapRate and Population) appear to be highly colinear (we will deal with this later).

###Transformations

We dont appear to need a tranformation to IntRate (no convincing trend appears).

```{r,fig.height=4}
plot(GDP_Rate ~ (IntRate) , data = econ)
```

Inflation looks like it needs a transformation. However, economic theory suggests a peak benefit inflation rate (with too low or too high inflation rates being detrimental to the economy). As such, we will try to make inflation a quadratic term in the model, and so do not transform it here.
```{r,fig.height=4}
plot(GDP_Rate ~ (Inflation) , data = econ)
```



From the matrix above, it appears that MCapRate might both be curved. We examine this trend further, below. There looks to be a parabolic relationship between GDP_Rate and MCapRate. To determine if this is the correct transformation, we must fit a linear model and look at the residuals. \textit{To be done after other transformations.}

```{r,fig.height=4}
plot(GDP_Rate ~ MCapRate , data = econ)
```

Next, we check if there is a transformation needed for the population explanatory variable. There does not seem any clear indication that there needs to be a transformation based on the below plot.

```{r,fig.height=4}
plot(GDP_Rate ~ Population , data = econ)
```

Next, we check if there is a transformation needed for the primary education explanatory variable. There is some clustering we would like to get rid of. However, no transformation seems to make the relationship between GDP_Rate and PrimEducRate any better.

```{r,fig.height=4}
par(mfrow=c(1,2))
plot(GDP_Rate ~ PrimEducRate , data = econ)
plot(GDP_Rate ~ sqrt(PrimEducRate) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ PrimEducRate , data = econ)
plot(GDP_Rate ~ log(I(PrimEducRate/100)) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ PrimEducRate , data = econ)
plot(GDP_Rate ~ I(1/(PrimEducRate)) , data = econ)
par(mfrow=c(1,1))
```

Next, we check if there is a transformation needed for the secondary education explanatory variable. There is some clustering we would like to get rid of. However, no transformations seem to improve the fit.

```{r,fig.height=4}
par(mfrow=c(1,2))
plot(GDP_Rate ~ SecEducRate , data = econ)
plot(GDP_Rate ~ log(SecEducRate) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ SecEducRate , data = econ)
plot(GDP_Rate ~ I(1/(SecEducRate)) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ SecEducRate , data = econ)
plot(GDP_Rate ~ sqrt(SecEducRate) , data = econ)
par(mfrow=c(1,1))
```

Finally, we check if there is a transformation needed for the tertiary education explanatory variable. There is some clustering we would like to get rid of. However, no transformations seem to improve the fit.

```{r,fig.height=4}
par(mfrow=c(1,2))
plot(GDP_Rate ~ TerEducRate , data = econ)
plot(GDP_Rate ~ log(TerEducRate) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ TerEducRate , data = econ)
plot(GDP_Rate ~ I(1/(TerEducRate)) , data = econ)
par(mfrow=c(1,1))
par(mfrow=c(1,2))
plot(GDP_Rate ~ TerEducRate , data = econ)
plot(GDP_Rate ~ sqrt(TerEducRate) , data = econ)
par(mfrow=c(1,1))
```


Trade ratio, poverty rate, and unemployment show no convincing needs for transformations:
```{r, fig.height = 4}
par(mfrow=c(1,3))
plot(GDP_Rate ~ (TradeRatio), data=econ)
plot(GDP_Rate ~ Unemployment, data=econ)
plot(GDP_Rate ~ Poverty, data=econ)
par(mfrow=c(1,1))
```

However, S.P500 might have a quadratic effect on GDP_Rate. We will test this as we fit our model. 
```{r}
plot(GDP_Rate ~ (S.P500) , data = econ)
```


###Preliminary Linear Model

Fitting only linear terms:
```{r}
test.lm1 <- lm(GDP_Rate ~ Inflation + IntRate + PrimEducRate +SecEducRate + TerEducRate + MCapRate+ Population + TradeRatio + Unemployment + S.P500 + Poverty +President + Senate + House, data = econ)
summary(test.lm1)
```


### Checking Residual Plots

First, we check the residual plot of our linear model against inflation. From before, using economic theory we would expect there to be a parabolic relationship. However, transforming inflation does not improve the fit and we proceed with the original model.
```{r,fig.height=4}
testTrans.lm <- lm(GDP_Rate ~ I(Inflation^2)+Inflation + IntRate + PrimEducRate +SecEducRate + TerEducRate + MCapRate+ Population + TradeRatio + Unemployment + S.P500 + Poverty +President + Senate + House, data = econ)
summary(testTrans.lm)
par(mfrow=c(1,2))
plot(resid(test.lm1) ~ Inflation , data = econ)
abline(h=0)
plot(resid(testTrans.lm) ~ Inflation, data = econ)
abline(h=0)
par(mfrow=c(1,1))
```

Next, we check the residual plot of our linear model against MCapRate. We noticed a parabolic relationship previously and check for this. However, on the basis of the residual plot this seems to not improve the model significantly. As such, we check for a log transformation instead. However, this does not improve the fit and we move forward with no transformation.
```{r,fig.height=4}
testTrans.lm <- lm(GDP_Rate ~ Inflation + IntRate + PrimEducRate + SecEducRate + TerEducRate +log(MCapRate)+ Population + TradeRatio + Unemployment + S.P500 + Poverty +President + Senate + House, data = econ)
testTrans1.lm <- lm(GDP_Rate ~ Inflation + IntRate + PrimEducRate + SecEducRate + TerEducRate +I(MCapRate^2)+ Population + TradeRatio + Unemployment + S.P500 + Poverty +President + Senate + House, data = econ)
summary(testTrans.lm)
par(mfrow=c(1,3))
plot(resid(test.lm1) ~ MCapRate, data = econ)
abline(h=0)
plot(resid(testTrans.lm) ~ MCapRate, data = econ)
abline(h=0)
plot(resid(testTrans1.lm) ~ log(MCapRate), data = econ)
abline(h=0)
par(mfrow=c(1,1))
```

Next, we check the residual plot of our linear model against S.P500. We noted a potential parabolic relationship previously, as such we check the residual plot. On the basis of the residual plot, a parabolic transformation seems inappropriate. However, there may be a need for a log transformation. This is wildly inappropriate and we move forward with no transformation.
```{r,fig.height=4}
testTrans.lm <- lm(GDP_Rate ~ Inflation + IntRate + PrimEducRate + SecEducRate + TerEducRate +MCapRate+ Population + TradeRatio + Unemployment + log(I(S.P500+.37))+ Poverty +President + Senate + House, data = econ)
testTrans1.lm <- lm(GDP_Rate ~ Inflation + IntRate + PrimEducRate + SecEducRate + TerEducRate +MCapRate+ Population + TradeRatio + Unemployment + I(S.P500^2) + Poverty +President + Senate + House, data = econ)
par(mfrow=c(1,3))
plot(resid(test.lm1) ~ S.P500, data = econ)
abline(h=0)
plot(resid(testTrans.lm) ~ S.P500, data = econ)
abline(h=0)
plot(resid(testTrans1.lm) ~ log(I(S.P500+.37)), data = econ)
abline(h=0)
par(mfrow=c(1,1))
```

Next, we check the residual plot of our linear model against IntRate, PrimEducRate, SecEducRate and TerEducRate. There does not seem to be any obvious transformations that will improve the fit.
```{r,fig.height=4}
par(mfrow=c(1,4))
plot(resid(test.lm1) ~ (PrimEducRate) , data = econ)
abline(h=0)
plot(resid(test.lm1) ~ (SecEducRate) , data = econ)
abline(h=0)
plot(resid(test.lm1) ~ (TerEducRate) , data = econ)
abline(h=0)
plot(resid(test.lm1) ~ (IntRate) , data = econ)
abline(h=0)
par(mfrow=c(1,1))
```

Next, we check the residual plot of our linear model against Population, Poverty, TradeRatio and Unemployment. As expected, we conclude there is no transformation to be performed.
```{r,fig.height=4}
par(mfrow=c(1,4))
plot(resid(test.lm1) ~ Population, data = econ)
abline(h=0)
plot(resid(test.lm1) ~ TradeRatio, data = econ)
abline(h=0)
plot(resid(test.lm1) ~ Unemployment, data = econ)
abline(h=0)
plot(resid(test.lm1) ~ Poverty, data = econ)
abline(h=0)
par(mfrow=c(1,1))
```

Finally, we check for a log-linear model. However, clearly the fit is not improved.
```{r,fig.height=4}
testTrans.lm <- lm(I(1/GDP_Rate) ~ Inflation + IntRate + PrimEducRate + SecEducRate + TerEducRate +MCapRate+ Population + TradeRatio + Unemployment + Poverty +President + Senate + House, data = econ)
par(mfrow=c(1,3))
plot(resid(test.lm1) ~ fitted(test.lm1), data = econ)
abline(h=0)
plot(resid(testTrans.lm) ~ fitted(testTrans.lm), data = econ)
abline(h=0)
par(mfrow=c(1,1))
```




###Case Influence Stats

Now we check for case influence stats. We notice that case 6, which is the year 1980 is exerting large influence on our model as it has a Cook's distance of 1.5. As such, we remove the point from our data set.
```{r, fig.height=4}
plot(test.lm1,which=5)
plot(test.lm1,which=4)
econ<-econ[-6,]
```

Cases 5 and 8 have large Cook's distances but leverage less than 2*p/n. However, case 8 does have a student residual close to -3, as well. However, since they both do not have a Cook's distance greater than 1 and residuals less than $\pm 2$ we include both cases.
```{r, fig.height=4}
econ.lm <- lm(GDP_Rate ~ Inflation + IntRate + PrimEducRate +SecEducRate + TerEducRate + MCapRate+ Population + TradeRatio + Unemployment + S.P500 + Poverty +President + Senate + House, data = econ)
summary(test.lm1)
2*15/35
hatvalues(econ.lm)
par(mfrow=c(1,3))
plot(econ.lm,which=5)
plot(econ.lm,which=4)
plot(resid(econ.lm) ~ fitted(econ.lm), data = econ)
par(mfrow=c(1,1))
```

